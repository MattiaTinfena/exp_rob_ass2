# Experimental Robotics laboratory Assignment 2

Made by:
- Elisa Martinenghi mat: 6504193
- Mattia Tinfena mat: 7852527
- Roberto Bertelli mat: 7289118

This repo is part of the submission for the second assignment of the Experimental Robotics laboratory course.

Based on a plan generated by a problem and a domain in pddl, in our simulation the robot computes 2 actions:
- Visits 4 given points in a specific environment (simple_world.sdf); for each point a marker is detected with the corresponding id.
- Re-visits the points in order of ascending id value; in this case the robot also gets closer to the marker and displays an image of the marker and a circle around it.

This behavious has been obtained in the following steps:
1. Plansys generates a plan.
2. The robot visits all markers thanks to Plansys calling `detect_id` node;
3. When all markers have been visited, the `change_state` node is executed, changing state to "acquiring" and marking the plan as succeded. 
Then it updates the problem, changing some predicates and setting a new goal (for each marker, a photo must be taken). Eventually it creates a new plan.
4. Plansys calls `capture_first` and `capture_others` nodes to take the photos.

This simulations has been realized with ROS2 Jazzy, Gazebo sim for the simulation environment, aruco_opencv library for marker (and their ids) detection, exp_rob_ass2 for launching and using Plansys in distributed form and nav2 for navigation and mapping in the environment.

#### Simulation 
![Simulation](./gifs/Ass2.gif)

### Environment setup
Use ROS2 Jazzy to ensure compatibility
1. Clone the following repositories in the src folder of your workspace:
```bashrc
    git clone https://github.com/MattiaTinfena/erl2
    git clone https://github.com/fictionlab/ros_aruco_opencv
    git clone https://github.com/MattiaTinfena/exp_rob_ass2.git
```
2. Make sure that aruco uses the topic `camera/image` and uses the correct dictionary (ARUCO_ORIGINAL)
3. Clone this repo in the user folder (where also the workspace should be):
```bashrc
    git clone https://github.com/osrf/gazebo_models
```
Then copy in `gazebo_models` the folder `aruco_box` located in the package `erl2`

```bashrc
    cp aruco_box ~/gazebo_models
```
4. Build the workspace with colcon
```bashrc
    colcon build
```

### Run the launchfile for the simulation
In your workspace, source the local_setup:
```bashrc
    source install/local_setup.bash
```
Then launch 
- the simulation environment, mapping and navigation with  
```bashrc
    ros2 launch exp_rob_ass2 simulation.launch.py
```
- plansys_interface with
```bashrc
    ros2 launch exp_rob_ass2 plansys.launch.py
```
- to create a plan and execute it
```bashrc
    ros2 run exp_rob_ass2 get_plan_and_execute
```